# Updating Google Sheets Inventory with Enhanced Metadata

This guide explains how to update the canonical Google Sheets inventory with enhanced metadata (slugs, time estimates, languages, etc.) generated by the automation scripts.

## Prerequisite: Generating the Merged CSV

Before updating the Google Sheet, you must generate the consolidated metadata file:

1. Ensure you have run all the individual enhancement scripts (or they have been run in CI):
   ```bash
   npm run enhance:metadata
   npm run enhance:slugs
   npm run enhance:time
   npm run enhance:language
   ```
2. Run the merge script to create the final update file:
   ```bash
   node scripts/merge-enhanced-metadata.js
   ```
3. Locate the generated file in `scripts/output/MERGED-enhanced-metadata-[YYYY-MM-DD].csv`.

---

## Method 1: Google Apps Script Tool (Recommended)

This is the safest method as it preserves all formatting (colors, conditional formatting, fonts) and only updates the specific metadata columns.

### Initial Setup (One-time only)
1. Open the [Google Sheets Inventory](https://docs.google.com/spreadsheets/d/1Xl27XUuV_n5zG9_8Xq_87wTzN-P_A2W_Zz4k5_W-Q4/edit).
2. Go to **Extensions > Apps Script**.
3. In the script editor, paste the contents of `scripts/google-apps-script-updater.gs`.
4. Click the **Save** icon (diskette) and name the project "Inventory Updater".
5. Close the tab and refresh your Google Sheet.

### Running the Update
1. Open the **Inventory Tools** menu that now appears in the top menu bar.
2. Select **Update Enhanced Columns**.
3. Open your generated CSV file (`MERGED-enhanced-metadata-...csv`) in a text editor (e.g., Notepad or VS Code).
4. Select all text (Ctrl+A / Cmd+A) and copy it.
5. Paste it into the dialog box in Google Sheets and click **Update Sheet**.
6. The script will match lessons by their **name** and update the metadata columns.

---

## Method 2: Manual VLOOKUP (Excel/PowerShell)

If you prefer not to use scripts, you can use VLOOKUP in Google Sheets or Excel.

1. **Import the CSV** into a new tab (named `Updates`) in the Google Sheet.
2. In the main tab, use a VLOOKUP formula for the columns you want to update:
   ```excel
   =VLOOKUP(A2, Updates!A:Z, column_index, FALSE)
   ```
3. **Copy and Paste Values Only** once you are satisfied with the results to remove the formulas.

---

## Troubleshooting

### "Name not found" errors
The script matches rows by the **name** column. If a lesson name has changed in either the script output or the Google Sheet, it won't be matched. Verify that the names match exactly (including spacing and capitalization).

### Column Mapping
The following columns are updated by the script:
- `author`
- `license`
- `contributor`
- `dateCreated`
- `dateModified`
- `datePublished`
- `inLanguage`
- `timeRequired`
- `identifier`
- `slug`
- `about`
- `abstract`
- `accessibilitySummary`

If you need to update other columns, you will need to modify the `colMap` in `google-apps-script-updater.gs`.
